<!DOCTYPE html>
<html>
<head>
  <title>Panel Admin</title>
</head>
<body>
  <h1>Panel de Administrador</h1>
  <div id="usuarios"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { 
      getFirestore, 
      doc, 
      getDoc, 
      collection, 
      getDocs, 
      updateDoc 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
    apiKey: "AIzaSyA9ikTNcOy9JsQlYqhxmz_OY_MC4nx3hR8",
    authDomain: "legajos-personales-app.firebaseapp.com",
    projectId: "legajos-personales-app",
    storageBucket: "legajos-personales-app.firebasestorage.app",
    messagingSenderId: "842431832637",
    appId: "1:842431832637:web:544df1edf8c8b43bd94054"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const contenedor = document.getElementById("usuarios");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "index.html";
        return;
      }

      const userDoc = await getDoc(doc(db, "usuarios", user.uid));

      if (!userDoc.exists() || userDoc.data().rol !== "admin") {
        alert("No sos administrador");
        window.location.href = "index.html";
        return;
      }

      cargarUsuarios();
    });

    async function cargarUsuarios() {
      const querySnapshot = await getDocs(collection(db, "usuarios"));
      contenedor.innerHTML = "";

      querySnapshot.forEach((docu) => {
        const data = docu.data();

        if (data.estado === "pendiente") {
          const div = document.createElement("div");
          div.innerHTML = `
            <p>${data.email} - Estado: ${data.estado}</p>
            <button onclick="activarUsuario('${docu.id}')">Activar</button>
            <hr>
          `;
          contenedor.appendChild(div);
        }
      });
    }

    window.activarUsuario = async function(uid) {
      await updateDoc(doc(db, "usuarios", uid), {
        estado: "activo"
      });

      alert("Usuario activado");
      cargarUsuarios();
    }
  </script>
</body>
</html>
